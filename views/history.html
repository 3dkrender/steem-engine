<header>
  <div class="group">
    <div>
      <button class="btn btn-back" onclick="SE.ShowBalances();">
        <i class="material-icons">chevron_left</i>
      </button>
    </div>

    <h2 class="m-0">
			<%= data.name + ' (' + data.symbol + ')' %>
		</h2>    
    
    <div class="buttons">
			<button class="btn btn-primary" onclick="sendTokens()">SEND</button>

			<% if(SE.GetToken(data.symbol).issuer == SE.User.name) { %>
				<button class="btn btn-primary" onclick="issueTokens()">ISSUE</button>
			<% } %>
    </div>
  </div>
</header>

<div class="container">
  <table class="tokensTable" data-sorting="true"></table>
</div>

<script>
  var data = <%= JSON.stringify(data) %>;
  var symbol = data.symbol;
  var tokenInfo = SE.User.balances.filter( r => r.symbol == symbol)[0];
  var balance = tokenInfo.balance;

	function DateColumn(value, options, rowdata) { return new Date(value).toLocaleString(); }
	function SteemAccountColumn(value, options, rowdata) { return '@' + value; }
	function BalanceColumn(value, options, rowdata) { 
		var operator = (rowdata.type == 'Received') ? '+' : '-';
		return '<div class="balance-cell ' + ((rowdata.type == 'Received') ? 'received' : 'sent') + '">' + operator + ' ' + addCommas(value) + ' ' + symbol + '</div>'; 
	}

	data.rows.forEach(r => {
		r.type = (r.to == SE.User.name) ? 'Received' : 'Sent';
		r.to_from = (r.to == SE.User.name) ? r.from : r.to;
	});

	$('.tokensTable').footable({
		"columns": [
			{ "name": "timestamp", "title": "Date", "formatter": DateColumn },
      { "name": "to_from", "title": "To/From", "formatter": SteemAccountColumn },
      { "name": "type", "title": "Type" },			
			{ "name": "quantity", "title": "Amount", "formatter": BalanceColumn  }
		],
		"rows": data.rows
  });
  
  function sendTokens() {    
    SE.ShowSendTokenDialog(symbol, balance);
  }

  function issueTokens() {    
    SE.ShowIssueTokenDialog(symbol, balance);
  }


</script>