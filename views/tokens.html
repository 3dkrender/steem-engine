<header>
  <div class="group">
    <h1 class="m-0 p-0">TOKENS</h1>    
    <div class="buttons">
			<input type="text" class="search" placeholder="Search Tokens"/>

			<% if(SE.User) { %>
				<button class="btn btn-primary" onclick="SE.ShowBuySSC();">BUY <%= Config.NATIVE_TOKEN %></button>
				<button class="btn btn-secondary" onclick="SE.ShowAddToken();">CREATE</button>
			<% } %>
    </div>
  </div>  
</header>

<div class="container">
  <table id="tokens_table" class="tokensTable interactiveTable" data-sorting="true"></table>
</div>

<script>
	var token_data = <%= JSON.stringify(data) %>;
	function SteemAccountColumn(value, options, rowdata) { return '@' + value; }
	function SupplyColumn(value, options, rowdata) { return addCommas(value); }
	function USDValueColumn(value, options, rowdata) { return value ? usdFormat(value) : '--'; }
	function URLFormatter(value, options, rowdata)
	{
		if(value != null) {
			if(!value.startsWith('http'))
				value = 'http://' + value;
				
			return '<a href="' + value + '" target="_blank" >' + value + '</a>';
		} else
			return '';
	}

	createTable(token_data);
	function createTable(data) {
		$('#tokens_table').empty();
		$('#tokens_table').footable({
			"on": {
				"ready.ft.table": function(e, ft) {
					if(SE.User) {
						$('#tokens_table tbody tr').bind('click', function() {          
							var index = $(this).index();        
							SE.ShowHistory(token_data[index].symbol, token_data[index].name);
						});
					}
				}
			},
			"columns": [
				{ "name": "symbol", "title": "Symbol" },
				{ "name": "name", "title": "Token Name" },
				{ "name": "marketCap", "title": "Market Cap", "type": "number", "classes": "text-right", "formatter": USDValueColumn },
				{ "name": "lastPrice", "title": "Price", "type": "number", "classes": "text-right", "formatter": USDValueColumn },
				{ "name": "volume", "title": "24h Vol", "type": "number", "classes": "text-right", "formatter": USDValueColumn },
				{ "name": "supply", "title": "Supply", "type": "number", "classes": "text-right", "formatter": SupplyColumn },    
				{ "name": "issuer", "title": "Issuer", "formatter": SteemAccountColumn }
			],
			"rows": data
		});
	}

	$('input.search').keyup(() => {
		var val = $('input.search').val().toLowerCase();
		$('#tokens_table tr').each((i, r) => {
			r = $(r);
			var td = r.children('td');

			if(td.length > 1) {
				if(td[0].innerText.toLowerCase().indexOf(val) >= 0 || td[1].innerText.toLowerCase().indexOf(val) >= 0)
					r.show();
				else
					r.hide();
			}
		});
		//createTable(token_data.filter(d => d.symbol.indexOf(val) >= 0 || d.name.indexOf(val) >= 0));
	})
</script>